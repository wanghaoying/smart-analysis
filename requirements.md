# AI数据分析平台需求文档  
**版本**：1.0  
**日期**：2025年7月22日  

---

## 一、项目概述  
构建支持多源数据接入的AI数据分析平台，通过LLM能力实现自然语言交互式分析、可视化及报告生成，降低数据分析门槛。

---

## 二、核心功能模块  
### 模块1：用户与资源管理  
| 功能点                | 详细需求                                                                 |
|-----------------------|--------------------------------------------------------------------------|
| 用户注册/登录         | 支持邮箱/手机号注册，拓展：OAuth2.0（微信/飞书/企业微信）                      |
| LLM资源配置           | 支持添加OpenAI、Hunyuan（腾讯混元）、通义千问等API密钥                   |
| 资源调度策略          | 用户可设置默认LLM（按用量优先级自动切换备用模型）                         |
| 用量监控              | 实时显示Token消耗（与费用预估）                                             |
| 会话管理              | 支持多轮对话历史保存、检索与恢复，用户可命名/归档会话，支持上下文追溯与引用 |

---

### 模块2：文件数据分析  
| 功能点                | 详细需求                                                                 |
|-----------------------|--------------------------------------------------------------------------|
| 数据上传              | 支持CSV/Excel（xlsx）/JSON（≤500MB），自动解析列名与数据类型              |
| 自然语言问答          | 示例：*“销量最高的产品是什么？” → 返回TOP5数据表格*                       |
| 智能可视化            | 支持指令生成图表：<br> *“用柱状图展示各地区销售额对比”* → 生成可编辑图表 |
| 报告生成              | 用户选择分析维度 → LLM自动撰写分析结论（文字+图表组合）                   |
| 多平台导出            | 支持导出PDF报告，同步至飞书文档/腾讯文档（需用户授权）                   |

---

### 模块3：数据库智能分析  
| 功能点                | 详细需求                                                                 |
|-----------------------|--------------------------------------------------------------------------|
| 数据库连接            | 支持MySQL/PostgreSQL，SSL加密传输                              |
| Schema自动扫描        | 自动识别表结构，提取字段注释（如存在）                                    |
| 知识库索引构建        | 自动生成表关系图谱，存储字段语义描述（e.g. `sales_amount` → "销售额")     |
| Text2SQL                | 示例：*“查询上海2024年Q1的退货率”* → 生成SQL并验证执行                    |
| 数据安全              | 仅允许读取元数据，SQL执行通过只读账号，敏感字段脱敏                        |

---

## 三、非功能性需求  
| 类别       | 要求                                                                 |
|------------|----------------------------------------------------------------------|
| 性能       | 文件解析<10s（100MB内），SQL生成响应<3s                              |
| 安全       | 数据加密存储（AES-256），API密钥托管（非明文存储）                    |
| 扩展性     | 插件式LLM接入框架，预留国产模型（文心一言、月之暗面）接口             |
| 兼容性     | 支持Chrome/Firefox/Edge最新版，飞书/腾讯文档API版本兼容2023+          |

---

## 四、关键实施路径  
1. **Phase 1（MVP）**：用户系统 + 文件问答（支持CSV+OpenAI）  
2. **Phase 2**：接入飞书/腾讯文档导出 + 可视化编辑器  
3. **Phase 3**：数据库分析模块（MySQL优先） + NL2SQL安全验证  
4. **Phase 4**：企业级功能（团队协作、审计日志、API开放）

---

## 五、风险与对策  
- **风险**：LLM生成SQL存在安全漏洞  
  **对策**：SQL语法树校验 + 敏感操作拦截（DELETE/DROP）  
- **风险**：大文件内存溢出  
  **对策**：流式分块处理 + 磁盘缓存机制  
- **风险**：国产模型API变动  
  **对策**：抽象LLM适配层，预留降级开关  

---

**下一步建议**：  
1. 优先设计数据权限模型（个人/团队/企业空间隔离）  
2. 验证Hunyuan等国产模型在数据分析场景的稳定性  
3. 调研LangChain框架简化LLM交互逻辑  

需要进一步细化某模块或补充技术细节可随时沟通。